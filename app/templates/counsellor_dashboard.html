{% extends "base.html" %}

{% block title %}Counsellor Dashboard{% endblock %}

{% block content %}
<div class="bg-white/70 backdrop-blur-xl rounded-3xl overflow-hidden shadow-2xl border border-white/50">
    <div class="px-6 py-6 sm:px-8 bg-indigo-50/50 border-b border-indigo-100 flex justify-between items-center">
        <div>
            <h3 class="text-xl leading-6 font-bold text-slate-900">Counsellor Dashboard</h3>
            <p class="mt-1 max-w-2xl text-sm text-slate-500">Manage your profile and student appointments.</p>
        </div>
        <span
            class="inline-flex items-center px-4 py-1 rounded-full text-sm font-bold bg-indigo-100 text-indigo-800 border border-indigo-200">
            Expert Guide
        </span>
    </div>

    <div class="px-6 py-6 sm:p-8 space-y-8">

        <!-- Profile Settings -->
        <div class="bg-white/80 rounded-2xl p-6 shadow-sm border border-slate-200">
            <h4 class="text-lg font-bold text-slate-900 mb-4">Profile Settings</h4>
            <form action="/counsellor/update" method="POST" class="space-y-4 max-w-xl">
                <div>
                    <label class="block text-sm font-medium text-slate-700">Your Fee per Session (in â‚¹)</label>
                    <input type="number" name="fee" value="{{ profile.fee if profile else 0 }}" required
                        class="mt-1 block w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-xl text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700">Availability (Times in a Week)</label>
                    <input type="text" name="availability_text" placeholder="e.g., Sat-Sun 10am-2pm" required
                        value="{% if profile and profile.availability %}{{ profile.availability.get('text', '') }}{% endif %}"
                        class="mt-1 block w-full px-4 py-2 bg-slate-50 border border-slate-300 rounded-xl text-slate-900 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors">
                    <p class="text-xs text-slate-500 mt-1">Specify your working days and hours so students know when to
                        book you.</p>
                </div>
                <button type="submit"
                    class="px-6 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-bold rounded-xl shadow-md shadow-indigo-200 transition-all hover:scale-[1.02]">
                    Update Profile
                </button>
            </form>
        </div>

        <!-- Upcoming Appointments -->
        <div class="bg-white/80 rounded-2xl p-6 shadow-sm border border-slate-200">
            <h4 class="text-lg font-bold text-slate-900 mb-4">Your Appointments</h4>
            {% if appointments %}
            <div class="space-y-4">
                {% for apt in appointments %}
                <div
                    class="flex items-center justify-between p-4 bg-slate-50 border border-slate-200 rounded-xl hover:bg-slate-100 transition-colors">
                    <div>
                        <p class="font-bold text-slate-900">{{ apt.student.full_name }}</p>
                        <p class="text-sm text-slate-500">Student ID: #{{ apt.student_id }} | Status: <span
                                class="text-emerald-600 font-semibold">{{ apt.payment_status }}</span></p>
                        <p class="text-sm font-medium text-slate-800 mt-1">Date: {{
                            apt.appointment_time.strftime('%Y-%m-%d %H:%M') if apt.appointment_time else 'To Be Decided'
                            }}</p>
                    </div>
                    <div class="flex flex-col items-end gap-2">
                        <a href="/join_meeting/{{ apt.id }}" target="_blank"
                            class="px-4 py-2 bg-violet-100 hover:bg-violet-200 text-violet-700 font-bold rounded-xl transition-colors">
                            Join Video Call
                        </a>
                        <form action="/appointment/delete/{{ apt.id }}" method="POST"
                            onsubmit="return confirm('Delete this appointment?')">
                            <button type="submit"
                                class="text-[10px] text-slate-400 hover:text-red-500 font-bold uppercase tracking-wider transition-colors">
                                <i class="fas fa-times mr-1"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="text-slate-500 italic">No appointments booked yet.</p>
            {% endif %}
        </div>

    </div>
</div>
{% endblock %}